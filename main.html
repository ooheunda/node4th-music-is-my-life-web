<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spartify</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap');

        * {
            font-family: 'Nanum Gothic', sans-serif;
        }


        .logo_box {
            background-color: #fff;
            width: 100%;
            height: 110px;
        }

        #logo {
            background-color: #fff;
            text-decoration: none;
            color: rgb(63, 47, 103);
            height: 50px;
            font-size: 55px;
            line-height: -50px;
            padding: 10px;
            position: absolute;
            top: 10px;
            left: 10px;
        }

        #logo:hover {
            color: #d9d2ea
        }

        .banner {
            width: 100%;
            position: absolute;
            background-color: black;
            height: 250px;
            background-image: url('https://images.chosun.com/resizer/TRylAoJ09lTz-DxqRkoC7Q5cmqA=/616x0/smart/cloudfront-ap-northeast-1.images.arcpublishing.com/chosun/IGUWJMF4RVAVNB4JXPDZLJME6Q.jpg');
        }

        .searchBtn_box {
            width: 100%;
            position: relative;
        }

        .searchBtn {
            position: absolute;
            top: -50px;
            right: 240px;
            width: 120PX;
            height: 40px;
            line-height: 40px;
            font-size: 19px;
            text-align: center;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: rgb(26, 16, 51);
            border-radius: 5px;
        }

        .searchBtn:before {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            background: rgb(26, 16, 51);
            color: #fff;
            transition: 0.5s;
            transform-origin: bottom;
            transform: translatey(-100%) rotatex(90deg);
            border-radius: 5px;
        }

        .searchBtn:hover:before {
            transform: translatey(0) rotatex(0deg);
        }

        .searchBtn:after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            background: rgb(26, 16, 51);
            color: #fff;
            transition: 0.5s;
            transform-origin: top;
            transform: translatey(0) rotatex(0deg);
            border-radius: 5px;
        }

        .searchBtn:hover:after {
            transform: translatey(100%) rotatex(90deg);
        }



        .postingBtn_box {
            width: 100%;
            position: relative;
        }

        .postingBtn {
            position: absolute;
            top: -50px;
            right: 80px;
            width: 140PX;
            height: 40px;
            line-height: 40px;
            font-size: 19px;
            text-align: center;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: rgb(26, 16, 51);
            border-radius: 5px;
            z-index: 0;
        }

        .postingBtn:before {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            background: rgb(26, 16, 51);
            color: #fff;
            transition: 0.5s;
            transform-origin: bottom;
            transform: translatey(-100%) rotatex(90deg);
            border-radius: 5px;
        }

        .postingBtn:hover:before {
            transform: translatey(0) rotatex(0deg);
        }

        .postingBtn:after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            background: rgb(26, 16, 51);
            color: #fff;
            transition: 0.5s;
            transform-origin: top;
            transform: translatey(0) rotatex(0deg);
            border-radius: 5px;
        }

        .postingBtn:hover:after {
            transform: translatey(100%) rotatex(90deg);
        }

        .video {
            width: 1100px;
            margin: 0px auto 0px auto;
            position: absolute;
            transform: translate(30%, 45%);
            z-index: 1;
        }

        .card-footer {
            height: 100%;
        }

        .categoryBtns {
            width: 100%;
            display: flex;
            flex-direction: column;
            transform: translate(2%, 45%);

        }

        .categoryBtns>button {
            font-size: 20px;
            background-color: #d9d2ea;
            color: #242424;

            box-shadow:
                0.3em 0.3em 0 0 var(--color),
                inset 0.3em 0.3em 0 0 var(--color);

            &:hover,
            &:focus {
                box-shadow:
                    0 0 0 0 var(--hover),
                    inset 6em 3.5em 0 0 var(--hover);
            }
        }

        @each $button, $color in $colors {
            .#{$button} {
                --color: #{$color};
                --hover: #{adjust-hue($color, 45deg)};
            }
        }


        button {
            color: var(--color);
            transition: 0.25s;

            &:hover,
            &:focus {
                border-color: var(--hover);
                color: #fff;
            }
        }

        button {
            background: none;
            font: inherit;
            margin: 0.7em;
            line-height: 0px;
            padding: 1em 1em;
            height: 40px;
            width: 170px;
        }

        /* 모달창 */
        .inputBtn {
            font-family: 'Nanum Gothic', sans-serif;
            background-color: #9281bc;
            color: white;
            border-color: transparent;
            border-radius: 5px;
        }

        .cancelBtn {
            background-color: white;
            color: black;
            border-color: #9281bc;
            border-radius: 5px;
        }

        .modal {
            position: absolute;
            display: none;

            justify-content: center;

            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.2);
        }

        .modal_body {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);

            width: 500px;
            height: 700px;
            padding: 30px;

            text-align: center;

            background-color: #d9d2ea;
            border-radius: 10px;
        }

        /* 인풋박스 */
        .form-floating>input {
            background-color: white;
            color: black;
        }

        .form-floating>label {
            color: #9281bc;
        }

        .input-group>label {
            background-color: white;
            color: black;
        }
    </style>

    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Firebase 구성 정보 설정
        const firebaseConfig = {
            apiKey: "AIzaSyD5r_o2TN5KDgpwOxZp2iy6tgqur-lTGC0",
            authDomain: "spartify-web.firebaseapp.com",
            projectId: "spartify-web",
            storageBucket: "spartify-web.appspot.com",
            messagingSenderId: "704263516784",
            appId: "1:704263516784:web:b67336ce32f39b51b67ab5",
            measurementId: "G-B346RD5FXM"
        };

        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Function to convert YouTube link to embeddable format
        function getYoutubeEmbedLink(link) {
            // Extract the video ID from the link
            var videoId;

            // Check if the link is a full URL or just the video ID
            if (link.includes("youtube.com")) {
                videoId = link.split('v=')[1];
            } else {
                videoId = link;
            }

            // Construct the embeddable link
            return `https://www.youtube.com/embed/${videoId}`;
        }

        // 모달창- 데이터 저장용 코드입니다
        $('#inputBtn').click(async function () {
            let link = $('#link').val();
            let title = $('#title').val();
            let singer = $('#singer').val();
            let user = $('#user').val();
            let comment = $('#comment').val();
            let category = $('#category').val();

            if (link == "" || title == "" || singer == "") {
                alert("링크, 제목, 가수는 필수값입니다.");
            } else {
                let doc = {
                    'link': link,
                    'title': title,
                    'singer': singer,
                    'user': user,
                    'comment': comment,
                    'category': category
                };

                await addDoc(collection(db, "songs"), doc);
                makeCard(link, title, singer, user, comment, category);

                alert("저장되었습니다.");
                window.location.reload();
            }

        })

        let docs = await getDocs(collection(db, "songs"));

        docs.forEach((doc) => {
            makeCardData(doc);
        });

        function makeCardData(doc, category) {
            let row = doc.data();

            if (category == null) { // 일반적인 경우, category를 입력 안 한 경우
                let link = row['link'];
                let title = row['title'];
                let singer = row['singer'];
                let user = row['user'];
                let comment = row['comment'];
                let category = row['category'];
                makeCard(link, title, singer, user, comment, category);
            } else if (row['category'] === `${category}`) { // 카테고리별로 만드는 경우
                let link = row['link'];
                let title = row['title'];
                let singer = row['singer'];
                let user = row['user'];
                let comment = row['comment'];
                let category = row['category'];
                makeCard(link, title, singer, user, comment, category);
            }
        }

        function makeCard(link, title, singer, user, comment, category) {
            let temp_html = `
            <div class="col">
                <div class="card h-100">
                    <iframe class="embed-responsive-item" src="${getYoutubeEmbedLink(link)}" allowfullscreen></iframe>
                    <div class="card-footer">
                        <h4 class="title">${title}</h4>
                        <i class="singer">${singer}</i>
                        <p>
                            <small class="user">${user} : </small>
                            <small class="comment">${comment}</small>
                            <br>
                            <small class="category">#${category}</small>
                        </p>
                    </div>
                </div>
            </div>`;
            $('#card').append(temp_html);
        }

        // 카테고리별 카드 출력단
        $('#categoryBtn').click(async function () {
            $('#card').empty();
            docs.forEach((doc) => {
                makeCardData(doc);
            });
        })

        $('#kpopBtn').click(async function () {
            $('#card').empty();
            docs.forEach((doc) => {
                makeCardData(doc, "K-POP");
            });
        })

        $('#balladBtn').click(async function () {
            $('#card').empty();
            docs.forEach((doc) => {
                makeCardData(doc, "Ballad");
            });
        })

        $('#jazzBtn').click(async function () {
            $('#card').empty();
            docs.forEach((doc) => {
                makeCardData(doc, "Jazz");
            });
        })

        $('#rbBtn').click(async function () {
            $('#card').empty();
            docs.forEach((doc) => {
                makeCardData(doc, "R&B");
            });
        })

        $('#popBtn').click(async function () {
            $('#card').empty();
            docs.forEach((doc) => {
                makeCardData(doc, "Pop");
            });
        })

        $('#rockBtn').click(async function () {
            $('#card').empty();
            docs.forEach((doc) => {
                makeCardData(doc, "Rock");
            });
        })

        $('#hiphopBtn').click(async function () {
            $('#card').empty();
            docs.forEach((doc) => {
                makeCardData(doc, "Hip Hop");
            });
        })

        $('#othersBtn').click(async function () {
            $('#card').empty();
            docs.forEach((doc) => {
                makeCardData(doc, "Others");
            });
        })

    </script>
</head>

<body style="background-color:#d9d2ea">
    <!-- 헤더(배너)
    - 작성하기 클릭 버튼 (add.html 페이지로 이동)
    - 이미지 -->

    <!-- 카테고리 (미정)
    - firebase에서 장르별로 선별하여 불러오기
    - 새로운 페이지로 이동시) 장르별 헤더 이미지 및 타이틀 수정
    - 메인페이지에서 카테고리 클릭시 선별 -->

    <!-- 음악 목록(카드)
    - 유튜브 api이용, 제목 가수명 추천이유 등 표시
    - firebase에서 데이터 불러오기
    - 좋아요 기능 -->


    <div class="logo_box">
        <a href="" id="logo"><i><strong>Spartify 🎶</strong></i></a>
    </div>
    <div class="banner"></div>

    <div class="searchBtn_box">
        <a href="#" class="searchBtn" data-text="검색">검색</a>
    </div>


    <div class="postingBtn_box">
        <a href="#" class="postingBtn" data-text="작성하기">작성하기</a>
    </div>

    <div class="video">
        <div class="row row-cols-1 row-cols-md-3 g-3" id="card">
        </div>
    </div>

    <div class="categoryBtns">
        <button class="categoryBtn" id="categoryBtn"><strong>카테고리</strong></button>
        <button class="kpopBtn" id="kpopBtn">K-POP</button>
        <button class="balladBtn" id="balladBtn">발라드</button>
        <button class="jazzBtn" id="jazzBtn">재즈</button>
        <button class="rbBtn" id="rbBtn">R & B</button>
        <button class="popBtn" id="popBtn">팝송</button>
        <button class="rockBtn" id="rockBtn">Rock</button>
        <button class="hiphopBtn" id="hiphopBtn">힙합</button>
        <button class="othersBtn" id="othersBtn">Others</button>
    </div>

    <div class="modal">
        <div class="modal_body">
            <div class="inputBox" id="inputBox">
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="link" placeholder="Youtube Link">
                    <label for="floatingInput">Youtube Link</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="title" placeholder="제목">
                    <label for="floatingInput">제목</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="singer" placeholder="가수">
                    <label for="floatingInput">가수</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="user" placeholder="작성자">
                    <label for="floatingInput">작성자</label>
                </div>
                <div class="form-floating mb-3">
                    <textarea class="form-control" placeholder="추천 이유" id="comment" style="height: 200px"></textarea>
                    <label for="floatingTextarea2">추천 이유</label>
                </div>
                <div class="input-group mb-5">
                    <select class="form-select" id="category" style="color: #9281bc">
                        <option selected>카테고리</option>
                        <option value="K-POP">K-POP</option>
                        <option value="Ballad">Ballad</option>
                        <option value="Jazz">Jazz</option>
                        <option value="R&B">R&B</option>
                        <option value="Pop">Pop</option>
                        <option value="Rock">Rock</option>
                        <option value="Hip Hop">Hip Hop</option>
                        <option value="Others">Others</option>
                    </select>
                </div>
            </div>
            <button class="inputBtn" id="inputBtn">작성 완료</button>
            <button class="cancelBtn">취소</button>
        </div>
    </div>
    <script> // 모달창용 스크립트입니다
        const modal = document.querySelector('.modal');
        const modalOpenBtn = document.querySelector('.postingBtn');
        const modalCloseBtn = document.querySelector('.cancelBtn');

        modalOpenBtn.addEventListener("click", () => {
            modal.style.display = "flex";
        })

        modalCloseBtn.addEventListener("click", () => {
            alert("작성이 취소되었습니다.")
            modal.style.display = "none";
        })
    </script>
</body>

</html>